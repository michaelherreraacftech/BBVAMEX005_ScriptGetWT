<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe Consolidado - An√°lisis de Capacidad Sistema Q-Flow</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body{font-family:'Aptos','Segoe UI',Tahoma,Geneva,Verdana,sans-serif;line-height:1.4;margin:0;padding:10px;background-color:#f5f5f5;font-size:12px}
        .container{max-width:1600px;margin:0 auto;background:white;padding:20px;border-radius:8px;box-shadow:0 0 15px rgba(0,0,0,0.1)}
        .document-info{background:#f8f9fa;padding:15px;border-radius:6px;margin-bottom:20px;border-left:4px solid #1a237e}
        .document-info-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;font-size:12px;color:#666}
        h1{color:#2c3e50;text-align:center;border-bottom:3px solid #3498db;padding-bottom:10px;margin-bottom:20px;font-size:24px}
        h2{color:#34495e;margin-top:25px;margin-bottom:15px;border-left:4px solid #3498db;padding-left:15px;font-size:18px}
        h3{color:#34495e;margin-top:20px;margin-bottom:10px;font-size:14px}
        .executive-summary{background:linear-gradient(135deg,#c0392b 0%,#8B0000 100%);color:white;padding:20px;border-radius:8px;margin-bottom:25px}
        .executive-summary h2{margin-top:0;color:white;border:none;padding:0;font-size:20px}
        .key-findings{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin:15px 0}
        .finding-card{background:rgba(255,255,255,0.1);padding:15px;border-radius:6px;text-align:center}
        .finding-value{font-size:2em;font-weight:bold;margin-bottom:5px;color:#f39c12}
        .finding-label{font-size:0.9em;opacity:0.9}
        .results-table{width:100%;border-collapse:collapse;margin:15px 0;font-size:11px}
        .results-table th,.results-table td{border:1px solid #ddd;padding:8px 6px;text-align:center}
        .results-table th{background:linear-gradient(135deg,#3498db,#2980b9);color:white;font-weight:bold}
        .results-table tr:nth-child(even){background-color:#f9f9f9}
        .results-table tr:hover{background-color:#e3f2fd}
        .pass{background-color:#2ecc71;color:white;padding:4px 8px;border-radius:12px;font-weight:bold;font-size:10px}
        .fail{background-color:#e74c3c;color:white;padding:4px 8px;border-radius:12px;font-weight:bold;font-size:10px}
        .chart-container-two{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:20px 0}
        .chart-container-four{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;margin:20px 0}
        .chart-box{background:white;padding:15px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1);height:300px}
        .chart-box.large{height:400px}
        .chart-box canvas{max-height:250px!important;max-width:100%!important}
        .chart-box.large canvas{max-height:350px!important}
        .chart-title{text-align:center;color:#2c3e50;margin-bottom:15px;font-weight:bold;font-size:14px}
        .analysis-section{background:#ecf0f1;padding:20px;border-radius:8px;margin:20px 0;font-size:12px}
        .critical-warning{background:#ffebee;border:2px solid #e74c3c;padding:15px;border-radius:8px;margin:20px 0;font-size:12px}
        .success-highlight{background:#e8f5e8;border:2px solid #2ecc71;padding:15px;border-radius:8px;margin:20px 0;font-size:12px}
        .recommendations{background:#e3f2fd;border-left:4px solid #2196f3;padding:15px;margin:20px 0;font-size:12px}
        .phase-indicator{display:inline-block;padding:4px 12px;border-radius:15px;font-weight:bold;font-size:10px;margin-right:8px}
        .phase-optimal{background:#2ecc71;color:white}
        .phase-warning{background:#f39c12;color:white}
        .phase-critical{background:#e74c3c;color:white}
        .nav-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:10px 0;border-bottom:1px solid #e0e0e0}
        .back-btn{background:linear-gradient(135deg,#3498db,#2980b9);color:white;padding:8px 16px;border:none;border-radius:6px;font-size:12px;font-weight:bold;cursor:pointer;display:flex;align-items:center;gap:8px;text-decoration:none;transition:all 0.3s ease}
        .back-btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(52,152,219,0.3);text-decoration:none;color:white}
        .back-btn:active{transform:translateY(0)}
        .page-title{color:#2c3e50;font-size:14px;font-weight:bold;margin:0}
        .pdf-header-full{display:none;text-align:center;margin-bottom:25px;padding:0;border-bottom:3px solid #1a237e;background:white}
        .pdf-header-full img{width:90%;max-width:1000px;height:auto;min-height:120px;max-height:150px;object-fit:contain;background:white;margin:10px auto 15px auto;display:block}
        @media print{
            .nav-header{display:none!important}
            body{background:white!important;font-size:10px!important;margin:0!important;padding:20px!important}
            .container{box-shadow:none!important;max-width:100%!important;padding:0!important;margin:0!important;background:white!important}
            .chart-box{height:250px!important;page-break-inside:avoid!important}
            .chart-box.large{height:300px!important;page-break-inside:avoid!important}
            .chart-box canvas{max-height:200px!important}
            .chart-box.large canvas{max-height:250px!important}
            .results-table{page-break-inside:avoid!important}
            .analysis-section{page-break-inside:avoid!important}
            .chart-container-two{page-break-inside:avoid!important}
            .chart-container-four{page-break-inside:avoid!important}
            h1,h2{page-break-after:avoid!important}
            h3{page-break-after:avoid!important;page-break-inside:avoid!important}
            .executive-summary{page-break-inside:avoid!important}
            .recommendations{page-break-inside:avoid!important}
            .pdf-header-full{display:block!important}
            .document-info{background:#f8f9fa!important}
            body{-webkit-print-color-adjust:exact!important;color-adjust:exact!important}
            .pass{background-color:#2ecc71!important;color:white!important}
            .fail{background-color:#e74c3c!important;color:white!important}
            @page{margin:0.4in}
            header,nav,.no-print{display:none!important}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="pdf-header-full">
            <img src="https://github.com/michaelherreraacftech/TESTBBVA002/raw/main/assets/images/header-acfv2.png" 
                 alt="ACF Technologies - Product Quality Assurance">
        </div>

        <div class="nav-header">
            <button class="back-btn" onclick="goBack()">
                <span>‚Üê</span>
                <span>Regresar</span>
            </button>
            <div class="page-title">Reporte Consolidado - Script ScriptGetWT</div>
            <button class="back-btn" onclick="downloadPDF()" style="background:linear-gradient(135deg,#f39c12,#e67e22)">
                <span>üìÑ</span>
                <span>Descargar PDF</span>
            </button>
        </div>

        <div class="document-info">
            <div class="document-info-grid">
                <div><strong>Fecha de Elaboraci√≥n:</strong> 4 de Junio, 2025</div>
                <div><strong>Entorno:</strong> QA-DESA</div>
                <div><strong>Cliente:</strong> BBVA Mex</div>
                <div><strong>Modalidad:</strong> Script ScriptGetWT Activo</div>
                <div><strong>Analista Responsable:</strong> Michael J Herrera B</div>
                <div><strong>Cargo:</strong> L√≠der de Aseguramiento de Calidad</div>
            </div>
        </div>

        <h1>An√°lisis de Capacidad Sistema Q-Flow - Entorno QA-DESA</h1>
        <p style="text-align:center;color:#7f8c8d;font-style:italic;margin-bottom:25px">
            Evaluaci√≥n Completa de Rendimiento: 12 a 48 Usuarios Concurrentes<br>
            <strong>Script ScriptGetWT Activo</strong>
        </p>

        <div class="executive-summary">
            <h2>üö® Resumen Ejecutivo</h2>
            <p><strong>Objetivo:</strong> Evaluar la capacidad del servidor QA-DESA para el sistema Q-Flow ejecutando Script ScriptGetWT bajo diferentes niveles de concurrencia de usuarios.</p>
            
            <div class="key-findings">
                <div class="finding-card">
                    <div class="finding-value">12</div>
                    <div class="finding-label">Usuarios Concurrentes<br>M√°ximos Operativos</div>
                </div>
                <div class="finding-card">
                    <div class="finding-value">13.8</div>
                    <div class="finding-label">TPS M√°ximo<br>Estable</div>
                </div>
                <div class="finding-card">
                    <div class="finding-value">61.99%</div>
                    <div class="finding-label">Tasa de Error<br>en Colapso Total</div>
                </div>
            </div>
        </div>

        <h2>üìà Resultados Consolidados por Prueba</h2>
        <table class="results-table">
            <thead>
                <tr>
                    <th>Prueba</th>
                    <th>Usuarios</th>
                    <th>Fase</th>
                    <th>Muestras</th>
                    <th>Errores</th>
                    <th>% Error</th>
                    <th>Tiempo Prom (ms)</th>
                    <th>Max (ms)</th>
                    <th>TPS</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>TESTBBVA004</strong></td>
                    <td>12</td>
                    <td><span class="phase-indicator phase-optimal">√ìPTIMA</span></td>
                    <td>3,696</td>
                    <td>19</td>
                    <td>0.51%</td>
                    <td>378</td>
                    <td>4,540</td>
                    <td>13.8</td>
                    <td><span class="pass">PASS</span></td>
                </tr>
                <tr>
                    <td><strong>TESTBBVA004</strong></td>
                    <td>24</td>
                    <td><span class="phase-indicator phase-critical">CR√çTICA</span></td>
                    <td>7,392</td>
                    <td>239</td>
                    <td>3.23%</td>
                    <td>505</td>
                    <td>1,741</td>
                    <td>23.8</td>
                    <td><span class="fail">FAIL</span></td>
                </tr>
                <tr>
                    <td><strong>TESTBBVA004</strong></td>
                    <td>36</td>
                    <td><span class="phase-indicator phase-critical">CR√çTICA</span></td>
                    <td>11,088</td>
                    <td>2,098</td>
                    <td>18.91%</td>
                    <td>737</td>
                    <td>2,533</td>
                    <td>28.4</td>
                    <td><span class="fail">FAIL</span></td>
                </tr>
                <tr>
                    <td><strong>TESTBBVA005</strong></td>
                    <td>48</td>
                    <td><span class="phase-indicator phase-critical">COLAPSO</span></td>
                    <td>14,784</td>
                    <td>9,165</td>
                    <td>61.99%</td>
                    <td>1,498</td>
                    <td>20,652</td>
                    <td>23.3</td>
                    <td><span class="fail">FAIL</span></td>
                </tr>
            </tbody>
        </table>

        <h2>üìä An√°lisis de Tendencias de Rendimiento</h2>
        
        <div class="chart-container-two">
            <div class="chart-box large">
                <div class="chart-title">Throughput vs Usuarios Concurrentes</div>
                <canvas id="throughputChart"></canvas>
            </div>
            <div class="chart-box large">
                <div class="chart-title">Tasa de Errores vs Usuarios Concurrentes</div>
                <canvas id="errorChart"></canvas>
            </div>
        </div>

        <div class="chart-container-two">
            <div class="chart-box large">
                <div class="chart-title">Tiempo de Respuesta Promedio vs Usuarios Concurrentes</div>
                <canvas id="responseTimeChart"></canvas>
            </div>
            <div class="chart-box large">
                <div class="chart-title">Tiempo de Respuesta M√°ximo vs Usuarios Concurrentes</div>
                <canvas id="maxTimeChart"></canvas>
            </div>
        </div>

        <h2>üñ•Ô∏è Evoluci√≥n del Uso de Recursos</h2>
        
        <div class="chart-container-four">
            <div class="chart-box">
                <div class="chart-title">SQL Server - Uso de CPU</div>
                <canvas id="sqlCpuChart"></canvas>
            </div>
            <div class="chart-box">
                <div class="chart-title">SQL Server - Uso de Memoria</div>
                <canvas id="sqlMemoryChart"></canvas>
            </div>
            <div class="chart-box">
                <div class="chart-title">IIS Servers - Uso Promedio de CPU</div>
                <canvas id="iisCpuChart"></canvas>
            </div>
            <div class="chart-box">
                <div class="chart-title">IIS Servers - Uso Promedio de Memoria</div>
                <canvas id="iisMemoryChart"></canvas>
            </div>
        </div>

        <h2>üîç An√°lisis Detallado por Fases</h2>

        <div class="success-highlight">
            <h3>‚úÖ Fase √ìptima (12 Usuarios)</h3>
            <ul>
                <li><strong>Rendimiento Estable:</strong> 13.8 TPS con tasa de error aceptable de 0.51%</li>
                <li><strong>Latencia Controlada:</strong> Tiempo promedio de 378ms, dentro de rangos aceptables</li>
                <li><strong>Recursos Equilibrados:</strong> SQL Server CPU 25-63%, IIS balanceado</li>
                <li><strong>√önico Punto Operativo:</strong> Es el √∫nico nivel de carga que cumple criterios de calidad</li>
            </ul>
        </div>

        <div class="critical-warning">
            <h3>üö® Fase Cr√≠tica (24 Usuarios)</h3>
            <ul>
                <li><strong>L√≠mite de Capacidad Alcanzado:</strong> 3.23% de errores supera el umbral del 3%</li>
                <li><strong>Degradaci√≥n Evidente:</strong> Latencia aumenta a 505ms (+34% vs 12 usuarios)</li>
                <li><strong>SQL Server Presionado:</strong> CPU sostenido 50-96%, cerca del l√≠mite</li>
                <li><strong>Punto de Quiebre:</strong> Primera evidencia de saturaci√≥n del sistema</li>
            </ul>
        </div>

        <div class="critical-warning">
            <h3>üö® Fase Cr√≠tica (36 Usuarios)</h3>
            <ul>
                <li><strong>Degradaci√≥n Severa:</strong> 18.91% de errores, 6x superior al l√≠mite aceptable</li>
                <li><strong>Latencia Extrema:</strong> 737ms promedio indica sistema severamente degradado</li>
                <li><strong>SQL Server Saturado:</strong> CPU 70-99%, completamente al l√≠mite</li>
                <li><strong>Duraci√≥n Extendida:</strong> 7 minutos vs 5 est√°ndar, sistema no se estabiliza</li>
            </ul>
        </div>

        <div class="critical-warning">
            <h3>üí• Colapso Total (48 Usuarios)</h3>
            <ul>
                <li><strong>Falla Catastr√≥fica:</strong> 61.99% de errores - Sistema completamente inoperativo</li>
                <li><strong>Throughput Colapsado:</strong> 23.3 TPS, menor que 36 usuarios</li>
                <li><strong>Latencia Cr√≠tica:</strong> 1,498ms promedio, 20.6 segundos m√°ximo</li>
                <li><strong>Duraci√≥n Cr√≠tica:</strong> 11 minutos, sistema nunca se recupera</li>
                <li><strong>Escalabilidad Negativa:</strong> Peor rendimiento con m√°s usuarios</li>
            </ul>
        </div>

        <div class="analysis-section">
            <h3>üíª Especificaciones de Infraestructura QA-DESA</h3>
            
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin:15px 0">
                <div style="background:white;padding:15px;border-radius:6px;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
                    <h4 style="margin-top:0;color:#e74c3c;font-size:13px;display:flex;align-items:center;gap:8px">
                        <span style="background:#e74c3c;color:white;width:20px;height:20px;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:10px">üìä</span>
                        SQL Server (BBVAMX-UATSQL1)
                    </h4>
                    <ul style="font-size:10px;margin:0;padding-left:15px;list-style-type:disc">
                        <li><strong>OS:</strong> Windows Server 2022 Datacenter</li>
                        <li><strong>CPU:</strong> AMD EPYC 7763 64-Core (2 Core, 4 Logical)</li>
                        <li><strong>RAM:</strong> 7.95 GB Total (2.07 GB Disponible)</li>
                        <li><strong>Virtualizaci√≥n:</strong> Hyper-V Virtual Machine</li>
                        <li><strong>Arquitectura:</strong> x64-based PC</li>
                    </ul>
                </div>
                
                <div style="background:white;padding:15px;border-radius:6px;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
                    <h4 style="margin-top:0;color:#27ae60;font-size:13px;display:flex;align-items:center;gap:8px">
                        <span style="background:#27ae60;color:white;width:20px;height:20px;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:10px">üåê</span>
                        IIS Server 1 (BBVAMX-UATIIS1)
                    </h4>
                    <ul style="font-size:10px;margin:0;padding-left:15px;list-style-type:disc">
                        <li><strong>OS:</strong> Windows Server 2022 Datacenter</li>
                        <li><strong>CPU:</strong> AMD EPYC 7763 64-Core (2 Core, 4 Logical)</li>
                        <li><strong>RAM:</strong> 7.95 GB Total (3.38 GB Disponible)</li>
                        <li><strong>Virtualizaci√≥n:</strong> Hyper-V Virtual Machine</li>
                        <li><strong>Rol:</strong> Web Services Q-Flow</li>
                    </ul>
                </div>
                
                <div style="background:white;padding:15px;border-radius:6px;box-shadow:0 2px 4px rgba(0,0,0,0.1)">
                    <h4 style="margin-top:0;color:#3498db;font-size:13px;display:flex;align-items:center;gap:8px">
                        <span style="background:#3498db;color:white;width:20px;height:20px;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:10px">üåê</span>
                        IIS Server 2 (BBVAMX-UATIIS2)
                    </h4>
                    <ul style="font-size:10px;margin:0;padding-left:15px;list-style-type:disc">
                        <li><strong>OS:</strong> Windows Server 2022 Datacenter</li>
                        <li><strong>CPU:</strong> AMD EPYC 7763 64-Core (2 Core, 4 Logical)</li>
                        <li><strong>RAM:</strong> 7.95 GB Total (4.49 GB Disponible)</li>
                        <li><strong>Virtualizaci√≥n:</strong> Hyper-V Virtual Machine</li>
                        <li><strong>Rol:</strong> Web Services Q-Flow</li>
                    </ul>
                </div>
            </div>
            
            <div style="background:#fff3cd;border:1px solid #ffeaa7;padding:10px;border-radius:6px;margin-top:15px">
                <p style="margin:0;font-size:11px;color:#856404"><strong>Nota Importante:</strong> 
                Todas las pruebas fueron ejecutadas con <strong>Script ScriptGetWT Activo</strong>, y todos los dem√°s Scripts desarrollados para el cliente inactivos. Eso en aras de evaluar la capacidad del sistema bajo la ejecuci√≥n de cada Script por separado.</p>
            </div>
        </div>

        <div class="analysis-section">
            <h3>üìã Observaciones T√©cnicas Clave</h3>
            <ul>
                <li><strong>Escalabilidad Limitada:</strong> ScriptGetWT no escala m√°s all√° de 12 usuarios operativos</li>
                <li><strong>Punto de Quiebre Temprano:</strong> 24 usuarios ya superan el umbral de calidad</li>
                <li><strong>SQL Server Cuello de Botella:</strong> Principal limitante en todas las pruebas</li>
                <li><strong>Degradaci√≥n Exponencial:</strong> De 3.23% a 61.99% errores entre 24-48 usuarios</li>
                <li><strong>Comportamiento Anti-escalable:</strong> Menor throughput con m√°s usuarios en colapso</li>
                <li><strong>Script Ineficiente:</strong> Mayor demanda de recursos comparado con otros scripts</li>
                <li><strong>Infraestructura Insuficiente:</strong> QA-DESA inadecuado para ScriptGetWT</li>
                <li><strong>L√≠mite Absoluto:</strong> 12 usuarios como m√°ximo operacional confirmado</li>
            </ul>
        </div>

        <div class="analysis-section">
            <h3>üìÑ Evidencia de Errores del Sistema</h3>
            <p style="margin:10px 0;font-size:11px">Durante las pruebas de alta carga se registraron errores cr√≠ticos que confirman la saturaci√≥n y limitaciones del Script ScriptGetWT:</p>
            
            <div style="background:white;padding:15px;border-radius:6px;margin:15px 0;border-left:3px solid #e74c3c">
                <h5 style="margin-top:0;color:#e74c3c;font-size:12px">üî¥ Error de Deadlock - Event ID: 2461704-2461782</h5>
                <div style="background:#f8f9fa;padding:8px;border-radius:4px;font-family:monospace;font-size:9px;margin:5px 0">
                    <strong>Event Time:</strong> 6/4/2025 9:58:xx AM<br>
                    <strong>Source:</strong> ReceptionPoint.SaveTicket<br>
                    <strong>Details:</strong> QFlow.Library.QFlowException: 1205: Transaction (Process ID 139) was deadlocked on lock resources with another process and has been chosen as the deadlock victim. Rerun the transaction.
                </div>
            </div>
            
            <div style="background:white;padding:15px;border-radius:6px;margin:15px 0;border-left:3px solid #e74c3c">
                <h5 style="margin-top:0;color:#e74c3c;font-size:12px">üî¥ Error de Timeout - Event ID: 2461784-2461836</h5>
                <div style="background:#f8f9fa;padding:8px;border-radius:4px;font-family:monospace;font-size:9px;margin:5px 0">
                    <strong>Event Time:</strong> 6/4/2025 9:58:xx AM<br>
                    <strong>Source:</strong> ReceptionPoint.SaveTicket<br>
                    <strong>Details:</strong> QFlow.Library.QFlowException: Execution Timeout Expired. The timeout period elapsed prior to completion of the operation or the server is not responding. Operation cancelled by user.
                </div>
            </div>
            
            <p style="margin:10px 0;font-size:11px">Se registraron m√°s de 80 eventos de error consecutivos durante las pruebas de 48 usuarios, todos relacionados con deadlocks de SQL Server y timeouts de ejecuci√≥n, confirmando el colapso total del sistema.</p>
            <p style="margin:10px 0;font-size:11px">El <strong>Log de eventos Q-Flow 04-06-2025.csv</strong> estar√° disponible para descarga y contiene el registro completo de todos los deadlocks, timeouts y errores de SQL Server para validaci√≥n t√©cnica detallada.</p>
        </div>

        <div class="recommendations">
            <h3>üéØ Recomendaciones Estrat√©gicas</h3>
            <h4>Para Script ScriptGetWT en QA-DESA:</h4>
            <ul>
                <li><strong>L√≠mite Operacional:</strong> M√°ximo 12 usuarios concurrentes</li>
                <li><strong>Monitoreo Cr√≠tico:</strong> Alertas cuando CPU SQL Server > 70%</li>
                <li><strong>Optimizaci√≥n Urgente:</strong> Revisar l√≥gica y consultas del script</li>
                <li><strong>Upgrade de Infraestructura:</strong> SQL Server requiere m√°s recursos</li>
            </ul>
        </div>

        <div class="critical-warning">
            <h3>‚ö†Ô∏è Requisito Cr√≠tico para Aprobaci√≥n</h3>
            <p><strong>Es indispensable validar el procesamiento de los deadlocks y timeouts identificados en las pruebas antes de proceder con la aprobaci√≥n de uso del Script ScriptGetWT en entornos de producci√≥n.</strong></p>
            <ul>
                <li><strong>Validaci√≥n de Deadlocks:</strong> Revisar y resolver los deadlocks de SQL Server identificados</li>
                <li><strong>An√°lisis de Timeouts:</strong> Evaluar los timeouts de ejecuci√≥n y su impacto en producci√≥n</li>
                <li><strong>Optimizaci√≥n Obligatoria:</strong> ScriptGetWT requiere optimizaci√≥n antes de uso productivo</li>
                <li><strong>L√≠mite Estricto:</strong> M√°ximo 12 usuarios concurrentes hasta resoluci√≥n de issues</li>
            </ul>
        </div>

        <div class="executive-summary">
            <h2>üí° Conclusiones Finales</h2>
            <p><strong>El Script ScriptGetWT presenta limitaciones cr√≠ticas de escalabilidad con un l√≠mite operativo estricto de 12 usuarios concurrentes en QA-DESA.</strong> 
            La degradaci√≥n exponencial que culmina en colapso total a 48 usuarios con 61.99% de errores confirma la necesidad urgente de optimizaci√≥n antes de uso productivo. 
            SQL Server representa el cuello de botella principal y requiere upgrade inmediato para soportar este tipo de operaciones.</p>
            
            <p style="margin-top:15px"><em>Este an√°lisis establece l√≠mites espec√≠ficos para Script ScriptGetWT y gu√≠a las decisiones cr√≠ticas de dimensionamiento para producci√≥n.</em></p>
        </div>
    </div>

<script>
// Funci√≥n robusta para esperar Chart.js
function waitForChart() {
    return new Promise((resolve) => {
        const checkChart = () => {
            if (typeof Chart !== 'undefined') {
                resolve();
            } else {
                setTimeout(checkChart, 100);
            }
        };
        checkChart();
    });
}

// Inicializaci√≥n de gr√°ficos consolidados
async function initializeCharts() {
    console.log('üîÑ Cargando gr√°ficos consolidados ScriptGetWT...');
    
    try {
        await waitForChart();
        console.log('‚úÖ Chart.js disponible, creando gr√°ficos consolidados...');
        
        const testData = {
            users: [12, 24, 36, 48],
            throughput: [13.8, 23.8, 28.4, 23.3],
            errorRate: [0.51, 3.23, 18.91, 61.99],
            avgResponseTime: [378, 505, 737, 1498],
            maxResponseTime: [4540, 1741, 2533, 20652],
            sqlCpu: [50, 75, 90, 95],
            sqlMemory: [35, 40, 70, 85],
            iisCpuAvg: [30, 35, 40, 35],
            iisMemoryAvg: [10, 12, 14, 20]
        };

        const commonConfig = {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.8,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Usuarios Concurrentes'
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        };

        // Gr√°fico de Throughput
        new Chart(document.getElementById('throughputChart'), {
            type: 'line',
            data: {
                labels: testData.users,
                datasets: [{
                    data: testData.throughput,
                    borderColor: '#f39c12',
                    backgroundColor: 'rgba(243, 156, 18, 0.1)',
                    borderWidth: 3,
                    pointBackgroundColor: ['#2ecc71', '#e74c3c', '#c0392b', '#8B0000'],
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 6,
                    tension: 0.3
                }]
            },
            options: {
                ...commonConfig,
                scales: {
                    ...commonConfig.scales,
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Transacciones por Segundo (TPS)'
                        }
                    }
                }
            }
        });

        // Gr√°fico de Errores
        new Chart(document.getElementById('errorChart'), {
            type: 'line',
            data: {
                labels: testData.users,
                datasets: [{
                    data: testData.errorRate,
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    borderWidth: 3,
                    pointBackgroundColor: ['#2ecc71', '#e74c3c', '#c0392b', '#8B0000'],
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 6,
                    tension: 0.3
                }]
            },
            options: {
                ...commonConfig,
                scales: {
                    ...commonConfig.scales,
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Porcentaje de Errores (%)'
                        }
                    }
                }
            }
        });

        // Gr√°fico de Tiempo Promedio
        new Chart(document.getElementById('responseTimeChart'), {
            type: 'line',
            data: {
                labels: testData.users,
                datasets: [{
                    data: testData.avgResponseTime,
                    borderColor: '#9b59b6',
                    backgroundColor: 'rgba(155, 89, 182, 0.1)',
                    borderWidth: 3,
                    pointBackgroundColor: ['#2ecc71', '#e74c3c', '#c0392b', '#8B0000'],
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 6,
                    tension: 0.3
                }]
            },
            options: {
                ...commonConfig,
                scales: {
                    ...commonConfig.scales,
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Tiempo de Respuesta (ms)'
                        }
                    }
                }
            }
        });

        // Gr√°fico de Tiempo M√°ximo
        new Chart(document.getElementById('maxTimeChart'), {
            type: 'line',
            data: {
                labels: testData.users,
                datasets: [{
                    data: testData.maxResponseTime,
                    borderColor: '#e67e22',
                    backgroundColor: 'rgba(230, 126, 34, 0.1)',
                    borderWidth: 3,
                    pointBackgroundColor: ['#e67e22', '#2ecc71', '#c0392b', '#8B0000'],
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 6,
                    tension: 0.3
                }]
            },
            options: {
                ...commonConfig,
                scales: {
                    ...commonConfig.scales,
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Tiempo M√°ximo (ms)'
                        }
                    }
                }
            }
        });

        const resourceConfig = {
            responsive: true,
            maintainAspectRatio: true,
            aspectRatio: 1.5,
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Usuarios'
                    }
                },
                y: {
                    beginAtZero: true,
                    max: 100,
                    title: {
                        display: true,
                        text: 'Uso (%)'
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        };

        // Gr√°ficos de recursos
        new Chart(document.getElementById('sqlCpuChart'), {
            type: 'bar',
            data: {
                labels: testData.users,
                datasets: [{
                    data: testData.sqlCpu,
                    backgroundColor: ['#2ecc71', '#f39c12', '#e74c3c', '#8B0000'],
                    borderWidth: 1
                }]
            },
            options: resourceConfig
        });

        new Chart(document.getElementById('sqlMemoryChart'), {
            type: 'bar',
            data: {
                labels: testData.users,
                datasets: [{
                    data: testData.sqlMemory,
                    backgroundColor: ['#3498db', '#5dade2', '#e74c3c', '#8B0000'],
                    borderWidth: 1
                }]
            },
            options: resourceConfig
        });

        new Chart(document.getElementById('iisCpuChart'), {
            type: 'bar',
            data: {
                labels: testData.users,
                datasets: [{
                    data: testData.iisCpuAvg,
                    backgroundColor: ['#27ae60', '#58d68d', '#f39c12', '#e67e22'],
                    borderWidth: 1
                }]
            },
            options: resourceConfig
        });

        new Chart(document.getElementById('iisMemoryChart'), {
            type: 'bar',
            data: {
                labels: testData.users,
                datasets: [{
                    data: testData.iisMemoryAvg,
                    backgroundColor: ['#8e44ad', '#a569bd', '#bb8fce', '#d2b4de'],
                    borderWidth: 1
                }]
            },
            options: resourceConfig
        });

        console.log('üéØ Todos los gr√°ficos consolidados ScriptGetWT creados exitosamente!');
        
    } catch (error) {
        console.error('‚ùå Error creando gr√°ficos consolidados:', error);
    }
}

// M√∫ltiples estrategias de inicializaci√≥n
document.addEventListener('DOMContentLoaded', initializeCharts);
window.addEventListener('load', initializeCharts);

// Si ya est√° cargado, ejecutar inmediatamente
if (document.readyState === 'complete') {
    initializeCharts();
}

// Funci√≥n de navegaci√≥n para SharePoint
function goBack() {
    if (window.history.length > 1) {
        window.history.back();
    } else {
        // Regresa al index.html principal
        window.location.href = '../index.html';
    }
}

// Tambi√©n funciona con tecla Escape
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        goBack();
    }
});

// Funci√≥n para descargar como PDF
function downloadPDF() {
    const originalTitle = document.title;
    document.title = 'Reporte_BBVA_Consolidado_ScriptGetWT_' + new Date().toISOString().split('T')[0];
    
    // Ocultar elementos que no queremos en el PDF
    const elementsToHide = document.querySelectorAll('.nav-header, header, nav');
    elementsToHide.forEach(el => el.style.display = 'none');
    
    // Configurar para impresi√≥n √≥ptima
    const originalStyles = {
        fontSize: document.body.style.fontSize,
        background: document.body.style.background,
        margin: document.body.style.margin,
        padding: document.body.style.padding
    };
    
    // Optimizar estilos para PDF
    document.body.style.fontSize = '9px';
    document.body.style.background = 'white';
    document.body.style.margin = '0';
    document.body.style.padding = '0';
    
    // Agregar configuraci√≥n de p√°gina para ocultar URLs
    const style = document.createElement('style');
    style.innerHTML = `
        @media print {
            @page { 
                margin: 0.5in; 
                size: A4;
            }
            .nav-header, header, nav { 
                display: none !important; 
            }
            body { 
                -webkit-print-color-adjust: exact; 
            }
        }
    `;
    document.head.appendChild(style);
    
    // Dar un momento para que se apliquen los estilos
    setTimeout(() => {
        window.print();
        
        // Restaurar estilos originales despu√©s de imprimir
        setTimeout(() => {
            document.title = originalTitle;
            document.body.style.fontSize = originalStyles.fontSize;
            document.body.style.background = originalStyles.background;
            document.body.style.margin = originalStyles.margin;
            document.body.style.padding = originalStyles.padding;
            
            // Mostrar elementos ocultos
            elementsToHide.forEach(el => el.style.display = '');
            
            // Remover el estilo agregado
            document.head.removeChild(style);
        }, 1000);
    }, 100);
}
</script>
</body>
</html>
